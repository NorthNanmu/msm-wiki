# 路由器集成总览

MSM 采用旁路由模式。主路由仅需完成 **DHCP DNS** 与 **静态路由** 两类配置即可工作。

## 变量约定

- `{MSM主机IP}`：部署 MosDNS / Mihomo / Sing-box 的主机 IP

## 必要配置

### 1. DHCP DNS

将主路由 DHCP 下发 DNS 指向 MSM：

| 配置项 | 值 |
| --- | --- |
| DNS 服务器 | 保持上游 DNS（路由器自身） |
| DHCP DNS | `{MSM主机IP}` |

> 说明：若主路由存在备用 DNS，可在故障切换策略中设置为备用值。

### 2. 静态路由（FakeIP）

将 FakeIP 网段路由到 MSM：

| 目标地址 | 网关 |
| --- | --- |
| `28.0.0.0/8` | `{MSM主机IP}` |
| `8.8.8.8/32` | `{MSM主机IP}` |
| `1.1.1.1/32` | `{MSM主机IP}` |

> 若启用 IPv6，请根据 MSM 实际配置添加 IPv6 静态路由。

### 3. 可选：Telegram 路由

| 目标地址 | 网关 |
| --- | --- |
| `149.154.160.0/22` | `{MSM主机IP}` |
| `149.154.164.0/22` | `{MSM主机IP}` |
| `149.154.172.0/22` | `{MSM主机IP}` |
| `91.108.4.0/22` | `{MSM主机IP}` |
| `91.108.20.0/22` | `{MSM主机IP}` |
| `91.108.56.0/22` | `{MSM主机IP}` |
| `91.108.8.0/22` | `{MSM主机IP}` |
| `95.161.64.0/22` | `{MSM主机IP}` |
| `91.108.12.0/22` | `{MSM主机IP}` |
| `91.108.16.0/22` | `{MSM主机IP}` |
| `67.198.55.0/24` | `{MSM主机IP}` |
| `109.239.140.0/24` | `{MSM主机IP}` |

### 4. 可选：Netflix 路由

| 目标地址 | 网关 |
| --- | --- |
| `207.45.72.0/22` | `{MSM主机IP}` |
| `208.75.76.0/22` | `{MSM主机IP}` |
| `210.0.153.0/24` | `{MSM主机IP}` |
| `185.76.151.0/24` | `{MSM主机IP}` |

## 验证方式

1. 在客户端执行 `nslookup google.com`，应返回 `28.0.0.0/8` 段地址
2. 白名单设备能访问国外站点，非白名单设备无法访问

## 选择你的路由器系统

- [RouterOS 配置](/zh/guide/routeros)
- [爱快配置](/zh/guide/ikuai)
- [OpenWrt 配置](/zh/guide/openwrt)
- [UniFi 配置](/zh/guide/unifi)

## 常见问题

### 为什么必须配置静态路由？

FakeIP 为虚拟 IP 段。若没有静态路由，客户端访问 FakeIP 会被主路由丢弃，导致国外域名无法访问。

### 为什么必须设置 DHCP DNS？

只有将 DNS 请求交给 MosDNS，分流规则与 FakeIP 才能生效。
